/* @created: Sat Aug 31 13:54:50 UTC+0800 2013*/
{
manifest : {
"name" : "ui","file" : "ui.json","version" : "1.0","description" : "","author" : "liu denggao","created" : "2013-08-30","modified" : "2013-08-30"
},
entity : {
"js.ui.data.TableData" : "$package(\"js.ui.data\");js.ui.data.TableData=function(rowCount,colCount,data){this._rowCount=0;this._colCount=0;this._actualRowCount=-1;this._actualColCount=-1;this._origData=null;this._data=null;this._attribsMap={\"table\":{\"id\":\"id\",\"className\":\"class\",\"width\":\"width\",\"height\":\"height\",\"cellspacing\":\"cellspacing\",\"cellpadding\":\"cellpadding\",\"align\":\"align\",\"border\":\"border\",\"bordercolor\":\"bordercolor\",\"frame\":\"frame\",\"rules\":\"rules\",\"style\":\"style\"},\"thead\":{\"className\":\"class\",\"style\":\"style\"},\"tbody\":{\"className\":\"class\",\"style\":\"style\"},\"tfoot\":{\"className\":\"class\",\"style\":\"style\"},\"tr\":{\"className\":\"class\",\"style\":\"style\"},\"td\":{\"className\":\"class\",\"rowspan\":\"rowspan\",\"colspan\":\"colspan\",\"style\":\"style\"}}\nthis._tagsMap={\"table\":\"table\",\"range\":\"tbody\",\"row\":\"tr\",\"column\":\"td\"}\nthis._rangeTagsGroup={\"root\":[\"table\",\"row\",\"column\"],\"rows\":[\"range\",\"row\",\"column\"],\"columns\":[\"row\",\"column\"],\"part\":[\"row\",\"column\"]}\nthis._TableData(rowCount,colCount,data);}\nvar _$class=js.ui.data.TableData;var _$proto=_$class.prototype;with(_$class){$name=\"TableData\";$extends(\"Object\");prototype._TableData=function(rowCount,colCount,data){this._rowCount=rowCount||0;this._colCount=colCount||0;this._origData=data;if(!data){this._data={arrangeMode:\"row\",data:[]}}else{this._data={arrangeMode:\"row\",attribs:{},data:[]}\nif(!Global.is(data,\"Object\")){this.addRowRange(data);}else{if(data.id)this._data.id=id;if(data.attribs)this._data.attribs=this._makeRangeAttribsByType(\"root\",data.attribs);if((data.arrangeMode||\"row\")==\"row\"){this._data.arrangeMode=\"row\";this.addRowRange(data.data);}else if(data.arrangeMode==\"column\"){this._data.arrangeMode=\"column\";this.addColumnRange(data.data);}}}}\nprototype.getRowCount=function(){return this._rowCount;}\nprototype.getColumnCount=function(){return this._columnCount;}\nprototype.getActualRowCount=function(){return this._actualRowCount;}\nprototype.getActualColumnCount=function(){return this._actualColCount;}\nprototype.getAttribsMap=function(){return this._attribsMap;}\nprototype.getTagsMap=function(){return this._tagsMap;}\nprototype.getRangeTagsGroup=function(){return this._rangeTagsGroup;}\nprototype.getData=function(){return this._data;}\nprototype.addRowRange=function(data){if(this._data.arrangeMode!=\"row\")return;this.insertRowRange(this._data.data,data,true);}\nprototype.insertRowRange=function(target,data,isRootRow){for(var i=0;i<data.length;i++){var row=data[i];if(Global.isArray(row)){this.insertRow(target,row);}else{switch(row.arrangeMode||\"row\"){case\"row\":var innerRows=target[target.length]={arrangeMode:\"row\",isHeader:!!row.isHeader,attribs:this._makeRangeAttribsByType(isRootRow?\"rows\":\"part\",row.attribs),data:[]};this.insertRowRange(innerRows.data,row.data,isRootRow);break;case\"column\":var innerColumns=target[target.length]={arrangeMode:\"column\",isHeader:!!row.isHeader,attribs:this._makeRangeAttribsByType(\"part\",row.attribs),data:[]};this.insertColumnRange(innerColumns.data,row.data,false);break;}}}}\nprototype.addColumnRange=function(data){if(this._data.arrangeMode!=\"column\")return;this.insertColumnRange(this._data.data,data,true);}\nprototype.insertColumnRange=function(target,data,isRootColumn){for(var i=0;i<data.length;i++){var column=data[i];if(Global.isArray(column)){this.insertColumn(target,column);}else{switch(column.arrangeMode||\"column\"){case\"row\":var innerRows=target[target.length]={arrangeMode:\"row\",attribs:this._makeRangeAttribsByType(\"part\",column.attribs),data:[]};this.insertRowRange(innerRows.data,column.data,false);break;case\"column\":var innerColumns=target[target.length]={arrangeMode:\"column\",attribs:this._makeRangeAttribsByType(isRootColumn?\"columns\":\"part\",column.attribs),data:[]};this.insertColumnRange(innerColumns.data,column.data,isRootColumn);break;}}}}\nprototype._makeRangeAttribsByType=function(type,attribs){var tags=this._rangeTagsGroup[type];var attribs1={};for(var i=0;i<tags.length;i++){var tag=tags[i],actualTag=this._tagsMap[tag];if(attribs&&attribs[tag]){attribs1[tag]={};var attribsMap1=this._attribsMap[actualTag];for(var key in attribsMap1){if(attribsMap1.hasOwnProperty(key)){attribs1[tag][key]=attribs[tag][key];}}}}\nreturn attribs1;}\nprototype.addRow=function(data){if(this._data.arrangeMode!=\"row\")return;this.insertRow(this._data.data,data);}\nprototype.insertRow=function(target,data){var cells=[];for(var i=0;i<data.length;i++){this.insertCell(cells,data[i]);}\ntarget.push(cells);}\nprototype.addColumn=function(data){if(this._data.arrangeMode!=\"column\")return;this.insertColumn(this._data.data,data);}\nprototype.insertColumn=function(target,data){var cells=[];for(var i=0;i<data.length;i++){this.insertCell(cells,data[i]);}\ntarget.push(cells);}\nprototype.insertCell=function(target,vData){if(typeof(vData)!=\"object\"){target.push(vData);}else{var attribs=target[target.length]={text:vData.text||\"\",data:vData.data,isHeader:!!vData.isHeader};var attribsMap=this._attribsMap[\"td\"];for(var key in attribsMap){if(attribsMap.hasOwnProperty(key)){attribs[key]=vData[key];}}}}\nprototype.defineTagAttrib=function(tag,attrib,tagAttrib){if(!this._attribsMap[tag])return;if(this._attribsMap[tag][attrib])return;this._attribsMap[tag][attrib]=tagAttrib;}\nprototype.fix=function(){if(!Global.is(this._data,\"Object\")){var sizeDatas=this._getRowRangeSizeData(this._data);this._actualRowCount=sizeDatas[1];this._actualColCount=sizeDatas[2];this._fixRowRange(this._data,sizeDatas,sizeDatas[1],sizeDatas[2]);}else if(this._data.arrangeMode==\"row\"){var sizeDatas=this._getRowRangeSizeData(this._data);this._actualRowCount=sizeDatas[1];this._actualColCount=sizeDatas[2];this._fixRowRange(this._data,sizeDatas,sizeDatas[1],sizeDatas[2]);}else if(this._data.arrangeMode==\"column\"){var sizeDatas=this._getColumnRangeSizeData(this._data);this._actualRowCount=sizeDatas[2];this._actualColCount=sizeDatas[1];this._fixColumnRange(this._data,sizeDatas,sizeDatas[1],sizeDatas[2]);}\nreturn this;}\nprototype._fixRowRange=function(vData,sizeData,maxRows,maxColumns){var sizeData1=sizeData[0];var actualRowCount=sizeData[1];var actualColCount=sizeData[2];var rows=[],iRow=-1;maxColumns=maxColumns||actualColCount;rows=Global.is(vData,\"Object\")&&vData.data||vData;for(var i=0;i<rows.length;i++){var row=rows[i];if(Global.is(row,\"Object\")){if(row.arrangeMode==\"row\"){this._fixRowRange(row,sizeData1[i],0,maxColumns);iRow+=sizeData1[i][1];}else if(row.arrangeMode==\"column\"){this._fixColumnRange(row,sizeData1[i],maxColumns,0);iRow+=sizeData1[i][2];}}else{var rowCells=row;iRow++;var rowColCount=sizeData1[i];var lastCell=rowCells.length?rowCells[rowCells.length-1]:null;if(lastCell&&Global.is(lastCell,\"Object\")&&lastCell.colspan==-1){lastCell.colspan=maxColumns-rowColCount+1;}else{rowCells.fill(\"\",maxColumns-rowColCount,rowCells.length);}}}\nrows.fill([].fill(\"\",maxColumns),maxRows-iRow-1,iRow+1);}\nprototype._fixColumnRange=function(vData,sizeData,maxColumns,maxRows){var sizeData1=sizeData[0];var actualColCount=sizeData[1];var actualRowCount=sizeData[2];var columns=[],iColumn=-1;maxRows=maxRows||actualRowCount;columns=Global.is(vData,\"Object\")&&vData.data||vData;for(var i=0;i<columns.length;i++){var column=columns[i];if(Global.is(column,\"Object\")){if(column.arrangeMode==\"column\"){this._fixColumnRange(column,sizeData1[i],0,maxRows);iColumn+=sizeData1[i][1];}else if(column.arrangeMode==\"row\"){this._fixRowRange(column,sizeData1[i],maxRows,0);iColumn+=sizeData1[i][2];}}else{var colCells=column;iColumn++;var colRowCount=sizeData1[i];var lastCell=colCells.length?colCells[colCells.length-1]:null;if(lastCell&&Global.is(lastCell,\"Object\")&&lastCell.rowspan==-1){lastCell.rowspan=maxRows-colRowCount+1;}else{colCells.fill(\"\",maxRows-colRowCount,colCells.length);}}}\ncolumns.fill([].fill(\"\",maxRows),maxColumns-iColumn-1,iColumn+1);}\nprototype._getRowRangeSizeData=function(vData){var rowsCells=[];var rows=[],iRow=-1,maxRows=0,maxColumns=0;if(Global.is(vData,\"Object\")){rows=vData.data;}else{rows=vData;}\nfor(var i=0;i<rows.length;i++){var row=rows[i];if(Global.is(row,\"Object\")){if(row.arrangeMode==\"row\"){var sizeDatas=this._getRowRangeSizeData(row);var sizeData=sizeDatas[0];maxRows+=sizeDatas[1];maxColumns=Math.max(maxColumns,sizeDatas[2]);rowsCells[++iRow]=sizeDatas;}else if(row.arrangeMode==\"column\"){var sizeDatas=this._getColumnRangeSizeData(row);maxRows+=sizeDatas[2];maxColumns=Math.max(maxColumns,sizeDatas[1]);rowsCells[++iRow]=sizeDatas;}}else{var rowCells=row;iRow++;if(iRow>=rowsCells.length)rowsCells[iRow]=0;for(var j=0;j<rowCells.length;j++){var cell=rowCells[j];rowsCells[iRow]+=1;if(cell&&Global.is(cell,\"Object\")){if(cell.colspan>1){rowsCells[iRow]+=cell.colspan-1;}\nif(cell.rowspan>1){for(var k=1;k<cell.rowspan;k++){rowsCells[iRow+k]=(iRow+k<rowsCells.length)?(rowsCells[iRow+k]+1):1;}}}};maxRows++;maxColumns=Math.max(maxColumns,rowsCells[iRow]);}}\nreturn[rowsCells,maxRows,maxColumns];}\nprototype._getColumnRangeSizeData=function(vData){var columnsCells=[];var columns=[],iColumn=-1,maxRows=0,maxColumns=0;if(Global.is(vData,\"Object\")){columns=vData.data;}else{columns=vData;}\nfor(var i=0;i<columns.length;i++){var column=columns[i];if(Global.is(column,\"Object\")){if(column.arrangeMode==\"column\"){var sizeDatas=this._getColumnRangeSizeData(column);var sizeData=sizeDatas[0];maxColumns+=sizeDatas[1];maxRows=Math.max(maxColumns,sizeDatas[2]);columnsCells[++iColumn]=sizeDatas;}else if(column.arrangeMode==\"row\"){var sizeDatas=this._getRowRangeSizeData(column);maxColumns+=sizeDatas[2];maxRows=Math.max(maxRows,sizeDatas[1]);columnsCells[++iColumn]=sizeDatas;}}else{var colCells=column;iColumn++;if(iColumn>=columnsCells.length)columnsCells[iColumn]=0;for(var j=0;j<colCells.length;j++){var cell=colCells[j];columnsCells[iColumn]+=1;if(cell&&Global.is(cell,\"Object\")){if(cell.rowspan>1){columnsCells[iColumn]+=cell.rowspan-1;}\nif(cell.colspan>1){for(var k=1;k<cell.colspan;k++){columnsCells[iColumn+k]=(iColumn+k<columnsCells.length)?(columnsCells[iColumn+k]+1):1;}}}};maxColumns++;maxRows=Math.max(maxRows,columnsCells[iColumn]);}}\nreturn[columnsCells,maxColumns,maxRows];}}",
"js.ui.parser.Table" : "$package(\"js.ui.parser\");$import(\"js.ui.data.TableData\");js.ui.parser.Table=function(database){this._database;this._Table(database);}\nvar _$class=js.ui.parser.Table;var _$proto=_$class.prototype;with(_$class){$name=\"Table\";$extends(\"Object\");prototype._Table=function(database){this._database=database;}\nprototype.getDatabase=function(){return this._database;}\nprototype.parse=function(){var data=this._database.getData();var html=\"\",htmlTag=\"table\",htmlAttribs=\"\",htmlBody=\"\";htmlAttribs=this._parseTagAttribs(this._database.getAttribsMap()[htmlTag],data.attribs&&data.attribs[\"table\"]);if(data.arrangeMode==\"row\"){htmlBody=this._parseRowRange(data.data,true).join(\"\");}else if(data.arrangeMode==\"column\"){htmlBody=this._parseColumnRange(data.data,true).join(\"\");}\nhtml=\"<\"+[].concat(htmlTag,htmlAttribs).join(\" \")+\">\"+htmlBody+\"</\"+htmlTag+\">\";return html;}\nprototype._parseRowRange=function(vData,isRootRow){var html=\"\",htmlTag=\"\",htmlAttribs={},htmlBody=\"\";var rows=[],htmlRows=[];rows=Global.is(vData,\"Object\")&&vData.data||vData;for(var i=0;i<rows.length;i++){var row=rows[i];if(Global.is(row,\"Object\")){if(row.arrangeMode==\"row\"){htmlRows.append(this._parseRowRange(row,isRootRow));}else if(row.arrangeMode==\"column\"){htmlRows.append(this._parseColumnRange(row,false,isRootRow));}}else{htmlRows.push(this._parseRow(row,Global.is(vData,\"Object\")?vData.attribs:null,isRootRow));}}\nif(isRootRow&&Global.is(vData,\"Object\")&&vData.attribs&&vData.attribs[\"range\"]){htmlTag=this._database.getTagsMap()[\"range\"];htmlAttribs=this._parseTagAttribs(this._database.getAttribsMap()[htmlTag],vData.attribs[\"range\"]);return html=\"<\"+[].concat(htmlTag,htmlAttribs1).join(\" \")+\">\"+htmlBody+\"</\"+htmlTag+\">\";}else{return htmlRows;}}\nprototype._parseColumnRange=function(vData,isRootColumn,isRootRow){var columns=[],htmlColumns=[],htmlFullColumn=[];columns=Global.is(vData,\"Object\")&&vData.data||vData;for(var i=0;i<columns.length;i++){var column=columns[i];if(Global.is(column,\"Object\")){if(column.arrangeMode==\"row\"){htmlColumns.push(this._parseRowRange(column,false));}else if(column.arrangeMode==\"column\"){htmlColumns.push(this._parseColumnRange(column,isRootColumn,false));}}else{var colCells=column,htmlColumn=[];for(var k=0,k1=0;k<colCells.length;k++){htmlColumn.push(this._parseCell(colCells[k],Global.is(vData,\"Object\")&&vData.attribs&&vData.attribs[\"column\"]||null));var rowspan=colCells[k]&&colCells[k].rowspan||1;for(var k2=1;k2<rowspan;k2++){htmlColumn.push(\"\");}\nk1+=rowspan;}\nhtmlColumns.push(htmlColumn);}}\nhtmlFullColumn=this._mergeColumns.apply(this,htmlColumns);if(isRootRow){var htmlTag=this._database.getTagsMap()[\"row\"];var htmlAttribs=this._parseTagAttribs(this._database.getAttribsMap()[htmlTag],\"\",Global.is(vData,\"Object\")&&vData.attribs&&vData.attribs[\"row\"]||null);htmlFullColumn=htmlFullColumn.map(function(cell){return\"<\"+[].concat(htmlTag,htmlAttribs).join(\" \")+\">\"+cell+\"</\"+htmlTag+\">\";});}\nreturn htmlFullColumn;}\nprototype._mergeColumns=function(){var argsLen=arguments.length;var lens=[],rows=[],maxRows=0;for(var j=0;j<argsLen;j++){lens[j]=arguments[j].length;}\nmaxRows=Math.max.apply(Math,lens);for(var i=0;i<maxRows;i++){for(var j=0;j<argsLen;j++){rows[i]=i<rows.length?rows[i]:[];rows[i][rows[i].length]=i<arguments[j].length?arguments[j][i]:\"\";}\nrows[i]=rows[i].join(\"\");}\nreturn rows;}\nprototype._parseRow=function(vData,oCommAttribs,isRootRow){var html=\"\",htmlTag=\"\",htmlAttribs=\"\",htmlBody=\"\";htmlTag=this._database.getTagsMap()[\"row\"];htmlBody=vData.map(function(cell){return this._parseCell(cell,oCommAttribs&&oCommAttribs[isRootRow?\"column\":\"row\"]||null);},this).join(\"\");if(isRootRow){htmlAttribs=this._parseTagAttribs(this._database.getAttribsMap()[htmlTag],\"\",oCommAttribs&&oCommAttribs[\"row\"]||null);html=\"<\"+[].concat(htmlTag,htmlAttribs).join(\" \")+\">\"+htmlBody+\"</\"+htmlTag+\">\";}else{html=htmlBody;}\nreturn html;}\nprototype._parseCell=function(vData,oCommAttribs){var htmlTag=\"\",htmlAttribs=[],htmlBody=\"\";htmlTag=oCommAttribs&&oCommAttribs.isHeader?\"th\":\"td\";htmlTag=vData&&Global.is(vData,\"Object\")&&vData.isHeader?\"th\":htmlTag;htmlBody=vData&&Global.is(vData,\"Object\")?vData.text:(\"\"+vData);htmlBody=htmlBody||\"&nbsp;\";htmlAttribs=this._parseTagAttribs(this._database.getAttribsMap()[\"td\"],vData,oCommAttribs);return\"<\"+[].concat(htmlTag,htmlAttribs).join(\" \")+\">\"+htmlBody+\"</\"+htmlTag+\">\";}\nprototype._parseTagAttribs=function(attribsMap,oAttribs,oCommAttribs){var htmlAttribs=[];var attribNames=[],tagAttribNames=[];var attribNames1=[],attribNames2=[];var attribValues1=[],attribValues2=[];for(var key in attribsMap){if(attribsMap.hasOwnProperty(key)){attribNames.push(key);tagAttribNames.push(attribsMap[key]);}}\nif(oAttribs&&Global.is(oAttribs,\"Object\")){attribNames2=attribNames.select(function(item){return!!oAttribs[item];});attribValues2=attribNames2.map(function(item){return oAttribs[item];});}\nif(oCommAttribs){attribNames1=attribNames.select(function(item){return!!oCommAttribs[item];});attribNames1=attribNames1.select(function(item){return!attribNames2.contains(item);});attribValues1=attribNames1.map(function(item){return oCommAttribs[item];});}\nhtmlAttribs.append(attribNames1.map(function(sName,index){return attribsMap[sName]+\"=\\\"\"+attribValues1[index]+\"\\\"\";}),attribNames2.map(function(sName,index){return attribsMap[sName]+\"=\\\"\"+attribValues2[index]+\"\\\"\";}));return htmlAttribs;}}",
"js.ui.PopupDialog" : "$package(\"js.ui\");$import(\"js.dom.HTML\");$import(\"js.dom.DOMTemplate\");js.ui.PopupDialog=function(){}\nvar _$class=js.ui.PopupDialog;with(_$class){$name=\"PopupDialog\";$extends(\"Object\");_$class._styleLib={\"std\":function(){var path=Engine.runtimeEnvironment.getResPath(\"js.ui\")+\"/PopupDialog\";if(!Browser.Engine.trident){return path+\"/std.css\";}else if(Browser.Engine.version<=3){return path+\"/std.IE6.css\";}else if(document.compatMode==\"CSS1Compat\"){return path+\"/std.css\";}else{return path+\"/std.IE.css\";}}()}\n_$class._styleSkin=\"\";_$class._defaultStyleSkin=\"std\";_$class._styleElement=null;_$class._isApped=false;_$class._isHidden=true;_$class._isAutoHide=true;_$class._htmlElement=null;_$class._outerElement=null;_$class._overlayElement=null;_$class._bodyStyleElement=null;_$class._callBack=null;_$class.returnValue;_$class.DISPLAY_MODE_CONTEXT=0;_$class.DISPLAY_MODE_DROPDOWN=1;_$class.DISPLAY_MODE_POSITION=2;_$class.DISPLAY_ALIGN_LEFT=0;_$class.DISPLAY_ALIGN_CENTER=1;_$class.DISPLAY_ALIGN_RIGHT=2;_$class.DISPLAY_ALIGN_UP=3;_$class.DISPLAY_ALIGN_MIDDLE=4;_$class.DISPLAY_ALIGN_BOTTOM=5;addProperty(true,true,\"htmlElement\",{get:function(){return this._htmlElement;}});addProperty(true,true,\"isHidden\",{get:function(){return this._isHidden;}});addMethod(true,true,\"show\",function(sURL,vArguments,oOptions,oFeatures,fnCallBack){if(!this._isHidden)this.hide();this._isHidden=false;var _this=this;var _owner=oOptions.owner;var _owner_htmElem=_owner.nodeName?_owner:(_owner.getHtmlElement?_owner.getHtmlElement():null);var _win_width=document.compatMode!=\"CSS1Compat\"?document.body.clientWidth:document.documentElement.clientWidth;var _win_height=document.compatMode!=\"CSS1Compat\"?document.body.clientHeight:document.documentElement.clientHeight;var _win_left=document.compatMode!=\"CSS1Compat\"?document.body.scrollLeft:!Global.Browser.Engine.webkit?document.documentElement.scrollLeft:document.body.scrollLeft;var _win_top=document.compatMode!=\"CSS1Compat\"?document.body.scrollTop:!Global.Browser.Engine.webkit?document.documentElement.scrollTop:document.body.scrollTop;var _event=oOptions.event;var _driver=oOptions.driver||\"html\";var _mode=oOptions.mode!=undefined?oOptions.mode:(_owner?1:0);var _autoHide=this._isAutoHide=_mode!=2||oOptions.autoHide==undefined||oOptions.autoHide;var _minWidth=oFeatures.minWidth||100;var _minHeight=oFeatures.minHeight||50;var _width=oFeatures.width||_minWidth;var _height=oFeatures.height||_minHeight;var _align=oFeatures.align!=undefined?oFeatures.align:this.DISPLAY_ALIGN_CENTER;var _left=oFeatures.left!=undefined?oFeatures.left:(_mode==2?-1:0);var _top=oFeatures.top!=undefined?oFeatures.top:(_mode==2?-1:0);var _right=oFeatures.right!=undefined?oFeatures.right:(_mode==2?-1:0);var _bottom=oFeatures.bottom!=undefined?oFeatures.bottom:(_mode==2?-1:0);var _emptyHtml=\"<div class=\\\"empty\\\">no data</div>\";this._htmlElement=document.body.appendChild(document.createElement(\"div\"));this._callBack=fnCallBack;if(!this._styleSkin)this.setStyleSkin(this._defaultStyleSkin);if(oFeatures.style)this.setBodyStyle(oFeatures.style);switch(_mode){case 0:_left=_event.pageX||(_event.clientX+document.body.scrollLeft-document.body.clientLeft);_top=_event.pageY||(_event.clientY+document.body.scrollTop-document.body.clientTop);break;case 1:var _owner_left=HTML.getLeftOnDoc(_owner_htmElem);var _owner_top=HTML.getTopOnDoc(_owner_htmElem);var _owner_width=_owner_htmElem.offsetWidth;var _owner_height=_owner_htmElem.offsetHeight;var _owner_leftWidth=_owner_left-_win_left+1;var _owner_rightWidth=(_win_left+_win_width-1)-(_owner_left+_owner_width-1)+1;var _owner_topHeight=_owner_top-_win_top+1;var _owner_bottomHeight=(_win_top+_win_height-1)-(_owner_top+_owner_height-1)+1;_width=Math.max(_minWidth,oFeatures.width||_owner_htmElem.offsetWidth);if(_width>_win_width){_left=_win_left;}else if(_width<=_owner_width+_owner_rightWidth){_left=_owner_left;}else if(_width<=_owner_width+_owner_leftWidth){_left=_owner_left+_owner_width-1-_width;}else{_left=_win_left+_win_width-_width;}\nif(_height>_win_height){_top=_win_top;}else if(_height<=_owner_bottomHeight){_top=_owner_top+_owner_height;}else if(_height<=_owner_topHeight){_top=_owner_top-_height;}else{_top=_win_top+_win_height-_height;}\nbreak;case 2:this._overlayElement=this._htmlElement;this._outerElement=document.body.appendChild(document.createElement(\"div\"));this._htmlElement=this._outerElement.appendChild(document.createElement(\"div\"));with(this._overlayElement){className=\"PopupDialogOverlay\";setAttribute(\"class\",\"PopupDialogOverlay\");if(Global.Browser.Engine.trident&&Global.Browser.Engine.version==3){innerHTML=\"<iframe frameborder=0 scrolling=no src=\\\"about:blank\\\"\"\n+\" style=\\\"width:100%;height:100%;z-index:-1;left:0;top:0;position:absolute;\\\"\"\n+\" onload=\\\"this.contentWindow.document.body.style.backgroundColor=\"\n+\" this.parentNode.currentStyle.backgroundColor!='transparent'?\"\n+\" this.parentNode.currentStyle.backgroundColor:this.parentNode.firstChild.currentStyle.backgroundColor;\\\"></iframe>\";}}\nwith(this._outerElement){className=\"PopupDialogOuter\";setAttribute(\"class\",\"PopupDialogOuter\");}\nif(_left!=-1&&_right!=-1){_left=-1;}\nif(_top!=-1&&_bottom!=-1){_top=-1;}\nif((_left!=-1||_right!=-1)&&(_top!=-1||_bottom!=-1)){}else if(_left!=-1||_right!=-1){switch(_align){case 3:_top=0;break;case 4:_top=Math.foolr((_win_height-_height)/2);break;case 5:_bottom=0;break;default:_top=Math.floor((_win_height-_height)/2);break;}}else if(_top!=-1||_bottom!=-1){switch(_align){case 0:_left=0;break;case 1:_left=Math.floor((_win_width-_width)/2);break;case 2:_right=0;break;}}else{switch(_align){case 0:_left=0;_top=Math.floor((_win_height-_height)/2);break;case 1:_left=Math.floor((_win_width-_width)/2);_top=Math.floor((_win_height-_height)/2);break;case 2:_right=0;_top=Math.floor((_win_height-_height)/2);break;case 3:_left=Math.floor((_win_width-_width)/2);_top=0;break;case 4:_left=Math.floor((_win_width-_width)/2);_top=Math.floor((_win_height-_height)/2);break;case 5:_left=Math.floor((_win_width-_width)/2);_bottom=0;break;}}\nbreak;}\nwith(this._htmlElement){className=\"PopupDialog\";setAttribute(\"class\",\"PopupDialog\");onclick=function(event){event=event||window.event;event.cancelBubble=true;}}\nif(_left!=-1)this._htmlElement.style.left=_left+\"px\";if(_top!=-1)this._htmlElement.style.top=_top+\"px\";if(_right!=-1)this._htmlElement.style.right=_right+\"px\";if(_bottom!=-1)this._htmlElement.style.bottom=_bottom+\"px\";this._htmlElement.style.width=(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?_width:(_width-2))+\"px\";this._htmlElement.style.height=(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?_height:(_height-2))+\"px\";this._htmlElement.style.zIndex=100;switch(_driver){case\"html\":if(typeof(sURL)!=\"string\"){this._htmlElement.innerHTML=_emptyHtml;}else if(sURL.charAt(0)==\"#\"){var el=Global.dom(sURL).pop();this._htmlElement.innerHTML=el?(el.value||el.text||_emptyHtml):_emptyHtml;}else{this._htmlElement.innerHTML=sURL;}\nbreak;case\"page\":if(typeof(sURL)!=\"string\"){this._htmlElement.innerHTML=_emptyHtml;}else if(sURL.charAt(0)==\"#\"){this._htmlElement.innerHTML=_emptyHtml;}else{with(this._htmlElement){innerHTML=\"<iframe frameborder=0 style=\\\"width:100%;height:100%;\\\" src=\\\"\"+sURL+\"\\\"></iframe>\";}}\nbreak;case\"template\":var tpl,json;if(sURL instanceof Global.DOMTemplate){tpl=sURL;}else if(typeof(sURL)!=\"string\"){}else if(sURL.charAt(0)==\"#\"){tpl=Global.DOMTemplate.newInstanceWithId(sURL.slice(1));}else{tpl=Global.DOMTemplate.newInstanceWithUrl(sURL);}\nswitch(typeof(vArguments)){case\"string\":if(vArguments.slice(0,9)==\"url(xml):\"){json=Global.xml2json(Global.get(vArguments.slice(0,9),\"\",false,\"\",\"XML\"));}else if(vArguments.slice(0,10)==\"url(json):\"){json=Global.get(vArguments.slice(0,10),\"\",false,\"\",\"JSON\");}else{json={};}\nbreak;case\"object\":json=vArguments;break;}\nif(tpl&&json){this._htmlElement.innerHTML=tpl.parse(json,null);if(json.init)json.init(this,this._htmlElement);}else{this._htmlElement.innerHTML=_emptyHtml;}\nbreak;}\nif(Browser.Engine.trident&&Browser.Engine.version==3){this._htmlElement.appendChild(document.createElement(\"<iframe frameborder=0 scrolling=no src=\\\"about:blank\\\"\"\n+\" style=\\\"width:100%;height:100%;z-index:-1;left:0;top:0;position:absolute;\\\"\"\n+\" onload=\\\"this.contentWindow.document.body.style.backgroundColor=\"\n+\" this.parentNode.currentStyle.backgroundColor!='transparent'?\"\n+\" this.parentNode.currentStyle.backgroundColor:this.parentNode.firstChild.currentStyle.backgroundColor;\\\"></iframe>\"));}\nif(_event){_event.cancelBubble=true;_event.returnValue=_event.result={activeApp:_this}}\nif(!this._isApped){document.body.attachEvent(\"onclick\",function(event){event=event||window.event;var data=event.result||event.returnValue;if(typeof(data)==\"object\"&&data.activeApp==_this){return;}else if(!_this._isHidden&&_this._isAutoHide){if(data)data.activeApp=null;_this.hide();}});this._isApped=true;}});addMethod(true,true,\"hide\",function(){if(this._isHidden)return;if(this._htmlElement)this._htmlElement.parentNode.removeChild(this._htmlElement);if(this._outerElement)this._outerElement.parentNode.removeChild(this._outerElement);if(this._overlayElement)this._overlayElement.parentNode.removeChild(this._overlayElement);if(this._bodyStyleElement)this._bodyStyleElement.parentNode.removeChild(this._bodyStyleElement);if(this._callBack)this._callBack(this.returnValue);this._isHidden=true;this._htmlElement=null;this._outerElement=null;this._bodyStyleElement=null;this._callBack=null;this.returnValue=undefined;});addMethod(true,true,\"addStyleSkin\",function(sName,sPath){this._styleLib[sName]=sPath;});addMethod(true,true,\"setStyleSkin\",function(sName){this._styleSkin=sName;if(!this._styleElement){var style=this._styleElement=document.createElement(\"link\");style.type=\"text/css\";style.rel=\"stylesheet\";style.href=this._styleLib[sName];document.getElementsByTagName(\"HEAD\")[0].appendChild(style);}else{this._styleElement.style.href=this._styleLib[sName];}});addMethod(true,true,\"setBodyStyle\",function(sPath){var _this=this;var style=this._bodyStyleElement=document.createElement(\"link\");style.type=\"text/css\";style.rel=\"stylesheet\";style.href=sPath;style.onload=function(){_this._htmlElement.style.zoom=1;}\ndocument.getElementsByTagName(\"HEAD\")[0].appendChild(style);});}",
"js.ui.SelectDialogBox" : "$package(\"js.ui\");js.ui.SelectDialogBox=function(){}\nvar _$class=js.ui.SelectDialogBox;with(_$class){$name=\"SelectDialogBox\";$extends(\"Object\");_$class._styleLib={\"std\":Engine.runtimeEnvironment.getResPath(\"js.ui\")+\"/SelectDialogBox/\"+(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?\"std.IE.css\":\"std.css\")}\n_$class._styleSkin=\"std\";_$class._localeLang=Engine.runtimeEnvironment.getLocaleLanguage();addProperty(true,true,\"localeLang\",{\"get\":function(){return this._localeLang;}});addMethod(true,true,\"show\",function(oDspTexts,oPara,oViewData,vValues,fnGetItemData,fnCallBack){var _this=this;var _minCellWidth=100;var _minHeight=50;var pageName=(Global.Browser.Platform.ios?\"index_for_ipad.htm\":\"index.htm\")+\"?seq=\"+(new js.lang.natives.Date()).getMilliseconds();oPara.opener=window;if(!oPara.icon){oPara.icon={}}\nif(oPara.cateDspMode==undefined){oPara.cateDspMode=0;}\nif(oPara.viewDspMode==undefined){oPara.viewDspMode=0;}\noPara.width=oPara.width||650;oPara.height=oPara.height||450;if(Global.Browser.Platform.ios){pageName=\"index_for_ipad.htm\";}else if(oPara.viewDspMode==0){if(Global.Browser.Engine.trident&&Global.Browser.Engine.version<=3){pageName=\"index_for_IE.htm\";}else{pageName=\"index.htm\";}}else{if(Global.Browser.Engine.trident&&Global.Browser.Engine.version<=3){pageName=\"index_tree_for_IE.htm\";}else{pageName=\"index_tree.htm\";}}\nvar ret=window.$showModalDialog(Engine.runtimeEnvironment.getResPath(\"js.ui\")+\"/SelectDialogBox/\"+pageName\n,{engineDir:Engine.runtimeEnvironment.getRootPath(),opener:window,oDspTexts:function(){if(!oDspTexts.button){switch(_this._localeLang){case\"\":case\"zh-CN\":oDspTexts.button={OK:\"\\u786e\\u5b9a\",Cancel:\"\\u53d6\\u6d88\"}\nbreak;case\"zh-HK\":oDspTexts.button={OK:\"\\u78ba\\u5b9a\",Cancel:\"\\u53d6\\u6d88\"}\nbreak;case\"en\":oDspTexts.button={OK:\"OK\",Cancel:\"Cancel\"}\nbreak;}}\nif(!oDspTexts.buttonTips){switch(_this._localeLang){case\"\":case\"zh-CN\":oDspTexts.buttonTips={add:\"\\u6dfb\\u52a0\",addAll:\"\\u6dfb\\u52a0\\u6240\\u6709\",remove:\"\\u5220\\u9664\",clear:\"\\u6e05\\u7a7a\",moveTop:\"\\u7f6e\\u9876\",moveUp:\"\\u5411\\u4e0a\\u79fb\\u52a8\",moveDown:\"\\u5411\\u4e0b\\u79fb\\u52a8\",moveBottom:\"\\u7f6e\\u5e95\"}\nbreak;case\"zh-HK\":oDspTexts.buttonTips={add:\"\\u6dfb\\u52a0\",addAll:\"\\u6dfb\\u52a0\\u6240\\u6709\",remove:\"\\u522a\\u9664\",clear:\"\\u6e05\\u7a7a\",moveTop:\"\\u7f6e\\u9802\",moveUp:\"\\u5411\\u4e0a\\u79fb\\u52d5\",moveDown:\"\\u5411\\u4e0b\\u79fb\\u52d5\",moveBottom:\"\\u7f6e\\u5e95\"}\nbreak;case\"en\":oDspTexts.buttonTips={add:\"Add\",addAll:\"Add All\",remove:\"Remove\",clear:\"Clear Empty\",moveTop:\"Move to Top\",moveUp:\"Move Up\",moveDown:\"Move Down\",moveBottom:\"Move to Bottom\"}\nbreak;}}\nswitch(_this._localeLang){case\"\":case\"zh-CN\":oDspTexts.status={loadingData:\"\\u6b63\\u5728\\u52a0\\u8f7d\\u6570\\u636e\"}\nbreak;case\"zh-HK\":oDspTexts.status={loadingData:\"\\u6b63\\u5728\\u52a0\\u8f09\\u6578\\u64da\"}\nbreak;case\"en\":oDspTexts.status={loadingData:\"Loading data\"}\nbreak;}\nreturn oDspTexts;}(),oPara:oPara,oViewData:oViewData,vValues:vValues,fnGetItemData:fnGetItemData},\"dialogWidth=\"+oPara.width+\"px;dialogHeight=\"+oPara.height+\"px;status:no\",fnCallBack);return ret;});addMethod(true,true,\"addStyleSkin\",function(sName,sPath){this._styleLib[sName]=sPath;});}",
"js.ui.menu.PopupMenuLite" : "$package(\"js.ui.menu\");$import(\"js.dom.HTML\");js.ui.menu.PopupMenuLite=function(owner,mode,options){this._id=\"\";this._owner=null;this._owner_htmElem=null;this._mode=0;this._mainMenu=null;this._activeMenu=null;this._isHideOnMouseLeave;this._offset=0;this._minWidth=0;this._padWidth=0;this._version=\"1.7.4 Final 20111109\";this.__usedIdCount=0;this._PopupMenuLite(owner,mode,options);}\nvar _$class=js.ui.menu.PopupMenuLite;var _$proto=_$class.prototype;with(_$class){$name=\"PopupMenuLite\";$extends(\"Object\");_$class._icons={checked:\"<span style=\\\"width:12px;height:12px;display:inline-block;overflow:hidden\\\"><span style=\\\"font-family:Marlett;font-size:16px;position:relative;top:-2;left:-1\\\">a</span></span>\",radioed:\"<span style=\\\"width:12px;height:12px;display:inline-block;overflow:hidden\\\"><span style=\\\"font-family:Marlett;font-size:9px;position:relative;top:2;\\\">n</span></span>\",arrow:\"<span style=\\\"width:12px;height:12px;display:inline-block;overflow:hidden\\\"><span style=\\\"font-family:'wingdings 3';font-size:12px;position:relative;top:;left:\\\">}</span></span>\",blank:\"<span style=\\\"width:12px;height:12px;display:inline-block;overflow:hidden\\\">&nbsp;</span>\"}\n_$class._styleLib={\"classic\":Engine.runtimeEnvironment.getResPath(\"js.ui.menu\")+\"/PopupMenuLite/\"+(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?\"Classic.IE.css\":\"Classic.css\"),\"xp\":Engine.runtimeEnvironment.getResPath(\"js.ui.menu\")+\"/PopupMenuLite/\"+(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?\"XP.IE.css\":\"XP.css\")}\n_$class._styleSkin=\"classic\";_$class._styleElement=null;_$class._activeAppMenu=null;_$class._isInstanced=false;prototype._PopupMenuLite=function(owner,mode,options){var thisObj=this;this._owner=owner;this._owner_htmElem=owner.nodeName?owner:(owner.getHtmlElement?owner.getHtmlElement():null);if(typeof(mode)!=\"undefined\")this._mode=mode;this._isHideOnMouseLeave=false;this._offset=options&&options.offset||0;if(options&&options.minWidth){this._minWidth=options.minWidth;}\nif(options&&options.padWidth){this._padWidth=options.padWidth;}\nthis.getClass().fireEvent(\"_onAppInstanced\",this);}\naddProperty(true,true,\"activeAppMenu\",{get:function(){return this._activeAppMenu;}});addProperty(false,true,\"owner\",{get:function(){return this._owner;}});addProperty(false,true,\"ownerHtmlElement\",{get:function(){return this._owner_htmElem;}});addProperty(false,true,\"mode\",{get:function(){return this._mode;},set:function(value){this._mode=value;}});addProperty(false,true,\"isHideOnMouseLeave\",{get:function(){return this._isHideOnMouseLeave;},set:function(value){this._isHideOnMouseLeave=value;}});addProperty(false,true,\"mainMenu\",{get:function(){return this._mainMain;}});addProperty(false,true,\"activeMenu\",{get:function(){return this._mainMenu;}});addProperty(false,true,\"version\",{get:function(){return this._version;}});addProperty(false,true,\"allCount\",{get:function(){if(!this._mainMenu)return 0;return this._mainMenu.getLength();}});addMethod(false,true,\"show\",function(event,iWidth,aCoordinate){if(this._mainMenu)this._mainMenu.show(event,iWidth,aCoordinate);});addMethod(false,true,\"hide\",function(){if(this._mainMenu)this._mainMenu.hide();});addMethod(false,true,\"addItem\",function(sTitle,vData,fnAction){var Menu=this.getClass().Menu;var Item=this.getClass().Item;if(!this._mainMenu){this._mainMenu=new Menu(this);}\nvar newItem=new Item(this._mainMenu,sTitle,vData,fnAction);this._mainMenu.addItem(newItem);return(newItem);});addMethod(false,true,\"getItem\",function(index){if(!this._mainMenu)return null;return this._mainMenu.getItem(index);});addMethod(false,true,\"getItemById\",function(id){if(!this._mainMenu)return null;return this._mainMenu.getItemById(id);});addMethod(true,true,\"addStyleSkin\",function(sName,sPath){this._styleLib[sName]=sPath;});addMethod(true,true,\"setStyleSkin\",function(sName){this._styleSkin=sName;if(!this._styleElement){var style=this._styleElement=document.createElement(\"link\");style.type=\"text/css\";style.rel=\"stylesheet\";style.href=this._styleLib[sName];document.getElementsByTagName(\"HEAD\")[0].appendChild(style);}else{this._styleElement.style.href=this._styleLib[sName];}});addMethod(true,true,\"fireEvent\",function(sEvent,oEventObject){if(typeof(this[sEvent])!=\"function\")return;try{return this[sEvent](oEventObject);}catch(e){throw new Error(1000,\"Event '\"+sEvent+\"' of object '\"+this.getName()+\"' has been runned error!\\nSource: \"\n+e.description);}});addEventListener(true,false,\"onFirstInstanced\",function(oAppMenu){var thisObj=this;if(Global.Browser.Platform.ios){document.body.attachEvent(\"ontouchmove\",function(event){thisObj.__isMoving=true;});document.body.attachEvent(\"ontouchend\",function(event){var data=event.result||event.returnValue;if(!thisObj.__isMoving){if(typeof(data)==\"object\"&&data.activeApp==thisObj){return;}else{thisObj.fireEvent(\"_onAppMenuBlur\");}}\nthisObj.__isMoving=false;});}else if(document.body.addEventListener){document.body.addEventListener(\"onclick\",function(event){event=event||window.event;var data=event.result||event.returnValue;if(typeof(data)==\"object\"&&data.activeApp==thisObj){return;}else{thisObj.fireEvent(\"_onAppMenuBlur\");}});}else{document.body.attachEvent(\"onclick\",function(event){event=event||window.event;var data=event.result||event.returnValue;if(typeof(data)==\"object\"&&data.activeApp==thisObj){return;}else{thisObj.fireEvent(\"_onAppMenuBlur\");}});}});addEventListener(true,false,\"onAppInstanced\",function(oAppMenu){if(this._isInstanced)return;this.fireEvent(\"_onFirstInstanced\",oAppMenu);});addEventListener(true,false,\"onAppMenuBeforeShow\",function(oAppMenu){if(this._activeAppMenu)this._activeAppMenu.hide();});addEventListener(true,false,\"onAppMenuShowed\",function(oAppMenu){this._activeAppMenu=oAppMenu;});addEventListener(true,false,\"onAppMenuHid\",function(oAppMenu){this._activeAppMenu=null;});addEventListener(true,false,\"onAppMenuBlur\",function(){var lastAppMenu=this._activeAppMenu;if(this._activeAppMenu)this._activeAppMenu.hide();this.fireEvent(\"onAppMenuBlur\",lastAppMenu);});addEventListener(false,false,\"onMenuBeforeShow\",function(oMenu){this.getClass().fireEvent(\"_onAppMenuBeforeShow\",this);});addEventListener(false,false,\"onMenuShowed\",function(oMenu){this.getClass().fireEvent(\"_onAppMenuShowed\",this);});addEventListener(false,false,\"onMenuHid\",function(oMenu){this.getClass().fireEvent(\"_onAppMenuHid\",this);});addEventListener(false,false,\"onDoAction\",function(oMenu){this.fireEvent(\"onDoAction\",oMenu.getLastDoneItem());});}\n_$class.Menu=function(owner){this._id=\"\";this._unid=\"\";this._owner=null;this._parentApp=null;this._htmlElement=null;this._htmlContainer=null;this._items=[];this._useIcon=false;this._loaded=false;this._activeItem=null;this._lastDoneItem=null;this._Menu(owner);}\nwith(_$class.Menu){$name=\"Menu\";$extends(Object);prototype._Menu=function(owner){this._owner=owner;this._parentApp=this._owner;}\nprototype.getLeft=function(){return this._x;}\nprototype.getTop=function(){return this._y;}\nprototype.getRight=function(){return this.getLeft()+this.getWidth()-1;}\nprototype.getBottom=function(){return this.getTop()+this.getHeight()-1;}\nprototype.getWidth=function(){return this._htmlElement.offsetWidth;}\nprototype.getHeight=function(){return this._htmlElement.offsetHeight;}\nprototype.getLength=function(){return this._items.length;}\nprototype.getParentApp=function(){return this._parentApp;}\nprototype.getOwner=function(){return this._owner;}\nprototype.getDisplayed=function(){if(!this._htmlElement)return false;return this._htmlElement.style.display==\"\";}\nprototype.getActiveItem=function(){return this._activeItem;}\nprototype.getLastDoneItem=function(){return this._lastDoneItem;}\nprototype.getIsActive=function(){if(this.getParentApp()._activeMenu==this)return true;else return false;}\nprototype.getUseIcon=function(){return this._useIcon;}\nprototype.addItem=function(newItem){this._items[this._items.length]=newItem;newItem._parentMenu=this;if(this._loaded){this.load(newItem);}\nreturn(newItem);}\nprototype.getItem=function(index){if(index<0||index>=this._items.length)return null;return this._items[index];}\nprototype.getItemById=function(id){for(var i=0;i<this._items.length;i++){var item=this.getItem(i);if(item.getId()==id)return(item);}\nreturn(null);}\nprototype.getItemByTitle=function(title){for(var i=0;i<this.getLength();i++){var item=this.getItem(i);if(item.getTitle()==title)return(item);}\nreturn(null);}\nprototype.getFirstItem=function(){return(this.getItem(0));}\nprototype.getNextItem=function(item){for(var i=0;i<this.getLength();i++){if(this.getItem(i).getId()==item.getId()){if(i==this.getLength()-1){return(null);}else{return(this.getItem(i+1));}}}\nthrow(\"\\u9519\\u8bef\\uff01\\\"PopupMenuLite.Menu.getNextItem(item)\\\"\\u8f93\\u5165\\u7684\\u83dc\\u5355\\u9879\\u4e0d\\u5728\\u672c\\u83dc\\u5355\\u4e2d\\u3002\");return(null);}\nprototype.getPrevItem=function(item){for(var i=0;i<this.getLength();i++){if(this.getItem(i).getId()==item.getId()){if(i==0){return(null);}else{return(this.getItem(i-1));}}}\nthrow(\"\\u9519\\u8bef\\uff01\\\"PopupMenuLite.Menu.getPrevItem(item)\\\"\\u8f93\\u5165\\u7684\\u83dc\\u5355\\u9879\\u4e0d\\u5728\\u672c\\u83dc\\u5355\\u4e2d\\u3002\");return(null);}\nprototype.getLastItem=function(){return(this.getItem(this.getLength()-1));}\nprototype.getAllItems=function(){return this._items;}\nprototype.show=function(event,iWidth,aCoordinate){var thisObj=this;var iLeft=0,iTop=0,iHeight=0;var aItems=this._getItemsToActualShow();this._lastDoneItem=null;event.returnValue=event.result={activeApp:this.getParentApp().getClass()}\nthis.fireEvent(\"_onBeforeShow\");if(this._items.length==0)return;if(!this._loaded)this._load();if(aCoordinate){iLeft=aCoordinate[0];iTop=aCoordinate[1];}else{switch(this.getParentApp().getMode()){case 0:iLeft=event.pageX||(event.clientX+document.body.scrollLeft-document.body.clientLeft);iTop=event.pageY||(event.clientY+document.body.scrollTop-document.body.clientTop);iWidth=Math.max(this._getMinWidth(aItems),iWidth||0);break;case 1:iLeft=HTML.getLeftOnDoc(this.getParentApp()._owner_htmElem);iTop=HTML.getBottomOnDoc(this.getParentApp()._owner_htmElem)+1;iWidth=Math.max(this._getMinWidth(aItems),iWidth||this.getParentApp()._owner_htmElem.offsetWidth);break;}\niLeft+=this._parentApp._offset;iWidth=Math.max(iWidth,this._parentApp._minWidth);iWidth+=this._parentApp._padWidth;}\niHeight=this._getMinHeight(aItems);this._htmlElement.style.left=iLeft+\"px\";this._htmlElement.style.top=iTop+\"px\";this._htmlElement.style.width=(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?iWidth:(iWidth-2))+\"px\";this._htmlElement.style.height=(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?iHeight:(iHeight-2))+\"px\";this._htmlElement.style.display=\"\";this._htmlContainer.style.width=(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?(iWidth-2):(iWidth-6))+\"px\";this._htmlContainer.style.height=(Browser.Engine.trident&&document.compatMode!=\"CSS1Compat\"?(iHeight-2):(iHeight-6))+\"px\";this._showSepLine();this.fireEvent(\"_onShow\");}\nprototype._showSepLine=function(){for(var i=0,iLen=this._items.length-1;i<iLen;i++){if(this._items[i].getTitle()==\"-\"){this._items[i]._htmlElement.style.display=\"block\";}}\nfor(var i=Math.max(0,this._items.length-1);i<this._items.length;i++){if(this._items[i].getTitle()==\"-\"){this._items[i]._htmlElement.style.display=\"none\";}}}\nprototype.hide=function(){if(!this.getDisplayed())return;if(this._htmlElement)this._htmlElement.style.display=\"none\";this.fireEvent(\"_onHide\");}\naddMethod(false,true,\"getVisibleCount\",function(){var count=0;for(var i=0;i<this._items.length;i++){if(!this._items[i].getIsHidden()){count++;}}\nreturn count;});prototype._toHtmlElement=function(){var thisObj=this;if(this._htmlElement)return;this._htmlElement=document.body.appendChild(document.createElement(\"div\"));with(this._htmlElement){className=\"OutsideBox PopupMenu\";setAttribute(\"class\",\"OutsideBox PopupMenu\");with(this._htmlContainer=appendChild(document.createElement(\"div\"))){className=\"InsideBox PopupMenuContent\";setAttribute(\"class\",\"InsideBox PopupMenuContent\");id=\"content\";}\nif(Browser.Engine.trident&&Browser.Engine.version==3){appendChild(document.createElement(\"<iframe frameborder=0 scrolling=no src=\\\"about:blank\\\"\"\n+\" style=\\\"width:100%;height:100%;z-index:-1;left:0;top:0;position:absolute;\\\"\"\n+\" onload=\\\"this.contentWindow.document.body.style.backgroundColor=\"\n+\" this.parentNode.currentStyle.backgroundColor!='transparent'?\"\n+\" this.parentNode.currentStyle.backgroundColor:this.parentNode.firstChild.currentStyle.backgroundColor;\\\"></iframe>\"));}\nonselectstart=function(event){return false;}\noncontextmenu=function(event){return false;}\nonmouseout=function(event){event=event||window.event;var toElement=event.toElement;if(HTML.contains(this,toElement))return;thisObj.fireEvent(\"_onMouseLeave\");}\nonclick=function(event){event=event||window.event;event.cancelBubble=true;}}}\nprototype._load=function(item){if(!this._htmlElement)this._toHtmlElement();if(item==null){if(this._loaded)return;for(var i=0;i<this._items.length;i++){item=this._items[i];item._toHtmlElement();item.refresh();}\nthis._loaded=true;}else{item._toHtmlElement();}}\nprototype._getItemsToActualShow=function(){var flagLastType=-1;var items=[];for(var i=0,iLen=this._items.length;i<iLen;i++){var item=this._items[i];if(item.getIsHidden())continue;if(item.getTitle()!=\"-\"){flagLastType=0;}else if(i>0&&i<(iLen-1)&&flagLastType==0){flagLastType=1;}else{continue;}\nitems[items.length]=item;}\nif(flagLastType==1)items.pop();return items;}\nprototype._getMinWidth=function(aItems){var width=0;for(var i=0;i<aItems.length;i++){var sTitle=Object(aItems[i].getTitle());var length=sTitle.getAsciiCount()+sTitle.getNonAsciiCount()*2;if(length>width)width=length;}\nwidth=3+14+2+width*6+2+12+3;return width;}\nprototype._getMinHeight=function(aItems){var height=6;for(var i=0;i<aItems.length;i++){if(aItems[i].getTitle()==\"-\")height+=6;else height+=18;}\nreturn height;}\naddEventListener(false,false,\"onBeforeShow\",function(){this.getParentApp().fireEvent(\"_onMenuBeforeShow\",this);});addEventListener(false,false,\"onShow\",function(){this.getParentApp().fireEvent(\"_onMenuShowed\",this);});addEventListener(false,false,\"onHide\",function(){this.getParentApp().fireEvent(\"_onMenuHid\",this);});addEventListener(false,false,\"onMouseLeave\",function(){if(this.getParentApp().getIsHideOnMouseLeave()){this.getParentApp().hide();}});addEventListener(false,false,\"onDoAction\",function(oItem){this._lastDoneItem=oItem;this._parentApp.fireEvent(\"_onDoAction\",this);});}\n_$class.Item=function(parentMenu,sTitle,vData,fnAction){this._id=\"\";this._unid=\"\";this._title=\"\";this._action=new Function();this._enabled=true;this._isHidden=false;this._parentMenu=null;this._parentApp=null;this._subMenu=null;this._data;this._htmlElement=null;this._Item(parentMenu,sTitle,vData,fnAction);}\nwith(_$class.Item){$name=\"Item\";$extends(Object);prototype._Item=function(parentMenu,sTitle,vData,fnAction){this._parentMenu=parentMenu;this._parentApp=this._parentMenu.getParentApp();this._unid=\"I\"+(++this._parentApp.__usedIdCount);this._title=sTitle;this._data=vData;if(typeof(fnAction)==\"function\"){this._action=fnAction;}}\nprototype.getId=function(){return this._id||this._unid;}\nprototype.setId=function(value){this._id=value;}\nprototype.getLeft=function(){return this.getParentMenu().getLeft()+3;}\nprototype.getTop=function(){var retValue=this.getParentMenu().getTop()+3;for(var i=0,index=this.getIndex();i<index;i++){retValue+=this.getParentMenu().getItem(i).getHeight();}\nreturn retValue;}\nprototype.getWidth=function(){return this._htmlElement.clientWidth;}\nprototype.getHeight=function(){return this._htmlElement.clientHeight;}\nprototype.getTitle=function(){return this._title;}\nprototype.getEnabled=function(){return this._enabled;}\nprototype.setEnabled=function(value){this._enabled=value;}\nprototype.getIsHidden=function(){return this._isHidden;}\nprototype.setIsHidden=function(value){this._isHidden=value;}\nprototype.getParent=function(){if(!this._parentMenu)return(null);return(this._parentMenu.getOwner());}\nprototype.getParentMenu=function(){return this._parentMenu;}\nprototype.getParentApp=function(){return this._parentApp;}\nprototype.getIndex=function(){for(var i=0,length=this.getParentMenu().getLength();i<length;i++){var item=this.getParentMenu().getItem(i);if(this==item)return i;}}\nprototype.getPosition=function(){return(this.getIndex()+1+\"\");}\nprototype.getHasChildren=function(){if(this._subMenu==null)return false;if(this._subMenu.getLength()==0)return false;return true;}\nprototype.getData=function(){return this._data;}\nprototype.setData=function(value){this._data=value;}\nprototype.getNextSiblingItem=function(){return this.getParentMenu().getNextItem(this);}\nprototype.getPrevSiblingItem=function(){return this.getParentMenu().getPrevItem(this);}\nprototype.refresh=function(){if(!this._htmlElement)return;this._htmlElement.style.color=this._enabled?\"\":\"gray\";if(this.getParentMenu().getUseIcon()){this._htmlElement.all['icon'].style.width=\"16px\";}}\nprototype.activate=function(){this._htmlElement.fireEvent(\"_onActivate\");}\nprototype._toHtmlElement=function(){if(this._htmlElement)return;if(this._title!=\"-\"){this._toHtmlElementForStd();}else{this._toHtmlElementForSep();}}\nprototype._toHtmlElementForStd=function(){var thisObj=this;if(this._isHidden)return;with(this._htmlElement=this.getParentMenu()._htmlContainer.appendChild(document.createElement(\"div\"))){className=\"PopupMenuItem\";setAttribute(\"class\",\"PopupMenuItem\");with(appendChild(document.createElement(\"span\"))){id=\"icon\";innerHTML=this.getParentApp().getClass()._icons[\"blank\"];}\nwith(appendChild(document.createElement(\"span\"))){id=\"title\";innerHTML=\"<span>\"+this._title+\"</span>\";}\nwith(appendChild(document.createElement(\"span\"))){id=\"sub\";innerHTML=this.getParentApp().getClass()._icons[\"blank\"];}\nif(Global.Browser.Platform.ios){ontouchmove=function(event){thisObj.__isMoving=true;}\nontouchend=function(){if(!thisObj.__isMoving){this.onclick();}\nthisObj.__isMoving=false;}}else{onmouseover=function(event){event=event||window.event;try{if(document.selection){if(document.selection.empty){document.selection.empty();}else{document.selection=null;}}else if(window.getSelection){window.getSelection().removeAllRanges();}}catch(e){}\nthisObj.fireEvent(\"_onActivate\",event);}\nonmouseout=function(event){event=event||window.event;thisObj.fireEvent(\"_onDeactivate\",event);}}\nonclick=function(event){event=event||window.event;thisObj.fireEvent(\"_onDoAction\");}\nondblclick=function(){return false;}\nonselectstart=function(){return false;}}}\nprototype._toHtmlElementForSep=function(){with(this._htmlElement=this.getParentMenu()._htmlContainer.appendChild(document.createElement(\"div\"))){className=\"PopupMenuSepLine\";setAttribute(\"class\",\"PopupMenuSepLine\");}}\nprototype._onActivate=function(oEvent){with(this._htmlElement){className=\"PopupMenuItem ActivePopupMenuItem\";setAttribute(\"class\",\"PopupMenuItem ActivePopupMenuItem\");}\nthis.getParentMenu()._activeItem=this;}\nprototype._onDeactivate=function(oEvent){with(this._htmlElement){className=\"PopupMenuItem\";setAttribute(\"class\",\"PopupMenuItem\");}\nthis.getParentMenu()._activeItem=null;}\nprototype._onDoAction=function(oEvent){if(!this._enabled)return;if(this._title==\"\"||this._title==\"-\")return;this.getParentApp()._mainMenu.hide();this._action(this.getParentApp().getOwner());this._parentMenu.fireEvent(\"_onDoAction\",this);}}",
"js.ui.form.FileUploader" : "$package(\"js.ui.form\");js.ui.form.FileUploader=function(oForm,oButton,oPara){this._form=null;this._button=null;this._files=[];this._status=0;this._controlName=\"\";this._pathSeparator=\"\";this._allowSameName=false;this._allowMultiple=true;this.__count=0;this._FileUploader(oForm,oButton,oPara);}\nvar _$class=js.ui.form.FileUploader;_$class._localeResource={\"onlyUploadSingle\":\"Only can upload single file!\",\"fileAlreadyExists\":\"File \\\"{0}\\\" already exists, cannot upload repeat!\"}\nwith(_$class){$name=\"FileUploader\";$extends(\"Object\");prototype._FileUploader=function(oForm,oButton,oPara){oPara=oPara||{};var _this=this;this._form=oForm;this._button=oButton;this._controlName=oPara.controlName;this._pathSeparator=oPara.pathSeparator||\"\\\\\";this._allowSameName=oPara.allowSameName||false;this._allowMultiple=oPara.allowMultiple||oPara.allowMultiple==undefined;if(oPara.onAddedFileItem)this.addEventListener(\"onAddedFileItem\",oPara.onAddedFileItem);if(oPara.onRemovedFileItem)this.addEventListener(\"onRemovedFileItem\",oPara.onRemovedFileItem);if(oPara.onValidateFile)this.addEventListener(\"onValidateFile\",oPara.onValidateFile);with(this._iframe=this._form.appendChild(document.createElement(\"iframe\"))){style.width=\"0\";style.height=\"0\";style.display=\"none\";contentWindow.appObj=this;onreadystatechange=function(){if(this.readyState!=\"complete\")return;_this._status=1;with(this.contentWindow.document){with(body){var el=document.createElement(\"input\");with(appendChild(el)){(parentWindow.eval||parentWindow.execScript)(\"var handler=(\"+_btnAddFile_onClick.toString()+\");\");onclick=parentWindow.handler;click();}}}}\nonload=function(){if(_this._status==1)return;_this._status=1;with(this.contentWindow.document){with(body){var el=document.createElement(\"input\");el.onclick=_btnAddFile_onClick;appendChild(el).click();}}}}\nif(this._status==0&&Global.Browser.Engine.webkit)this._iframe.onload();function _btnAddFile_onClick(){var window=this.ownerDocument.parentWindow||this.ownerDocument.defaultView;var document=this.ownerDocument;var appObj=window.appObj;appObj._button.onclick=function(){var elFile=appObj._addFileUploader();elFile.onchange=function(){if(this.value==\"\"){this.parentNode.removeChild(elFile);return null;}else{return appObj._addFileItem(elFile);}}\nelFile.click();}}}\nprototype.getCount=function(){return this._files.length;}\nprototype.getPathSeparator=function(){return this._pathSeparator;}\nprototype._addFileItem=function(elFile){if(!this._allowMultiple){alert(this._getLocale(\"onlyUploadSingle\"));elFile.parentNode.removeChild(elFile);return;}else if(!this.fireEvent(\"_onValidateFile\",elFile.value)){elFile.parentNode.removeChild(elFile);return;}\nthis._files[this._files.length]=new(this.getClass().FileItem)(this,elFile);this.fireEvent(\"_onAddedFileItem\",this._files.getLast());}\nprototype._addFileUploader=function(){var el=document.createElement(\"input\");el.type=\"file\";el.name=this._controlName;el.style.display=\"none\";return this._form.appendChild(el);}\nprototype.getFileItem=function(index){return this._files[index];}\nprototype.getFileItemById=function(id){return this._files.getFirst(function(file){return file.getId()==id;});}\nprototype.getFileItemByName=function(name){return this._files.getFirst(function(file){return file.getName().toLowerCase()==name.toLowerCase();});}\nprototype._getLocale=function(key,value){var strObj=Global.Object(this.getClass()._localeResource[key]);return strObj.format.apply(strObj,Global.js.lang.natives.Array.from(arguments).slice(1)).valueOf();}\nprototype._onAddedFileItem=function(oItem){this.fireEvent(\"onAddedFileItem\",oItem);}\nprototype._onRemovedFile=function(oItem){this._files.earse(oItem);this.fireEvent(\"onRemovedFileItem\",oItem);}\nprototype._onValidateFile=function(sFile){var sName=sFile.word(this.getPathSeparator(),-1);if(!this._allowRepeat){if(this._files.some(function(file){return file.getName().toLowerCase()==sName.toLowerCase();})){alert(this._getLocale(\"fileAlreadyExists\",sName));return false;}}\nif(this.hasEvent(\"onValidateFile\"))return this.fireEvent(\"onValidateFile\",sFile);return true;}}\n_$class.FileItem=function(parent,file){this._parent=null;this._id=\"\";this._name=\"\";this._path=\"\";this._file=null;this._FileItem(parent,file);}\nwith(_$class.FileItem){$name=\"FileItem\";$extends(\"Object\");prototype._FileItem=function(parent,file){this._parent=parent;this._id=\"\"+(++parent.__count);this._name=file.value.word(parent.getPathSeparator(),-1);this._path=file.value;this._file=file;}\nprototype.getId=function(){return this._id;}\nprototype.getName=function(){return this._name;}\nprototype.getPath=function(){return this._path;}\nprototype.getParent=function(){return this._parent;}\nprototype.remove=function(){this._parent.fireEvent(\"_onRemovedFileItem\",this);}}",
"js.ui.form.AttachmentList" : "$package(\"js.ui.form\");$import(\"js.dom.HTMLEncoder\");js.ui.form.AttachmentList=function(id,oTmpl,oPara,data){this._id=\"\";this._name=\"\";this._title=\"\";this._editMode=0;this._embedMode=0;this._columns=[];this._files=[];this._baseUrl=\"\";this._data=null;this._status=0;this._onlySingle=false;this._canAdd=true;this._canUpdate=true;this._canOpen=true;this._canDownload=true;this._canDelete=true;this._allowExtName=[];this._parent=null;this._template=null;this._target=null;this._startPos=null;this._endPos=null;this._interface={};this._events={};this._AttachmentList(id,oTmpl,oPara,data);}\nvar _$class=js.ui.form.AttachmentList;_$class._localeResource={\"onlyUploadSingle\":\"Only upload single file!\",\"fileAlreadyExists\":\"File \\\"{0}\\\" already exists, cannot upload repeat!\",\"notAllowUploadOtherTypeFile\":\"Does not allow uploading of type \\\"{0}\\\" file outside!\",\"mustUpdateSameFileName\":\"File name you need to update must be same with new file name!\"}\nwith(_$class){$name=\"AttachmentList\";$extends(\"Object\");prototype._AttachmentList=function(id,oTmpl,oPara,data){oPara=oPara||{};this._id=id;this._template=oTmpl;this._title=oPara.title||\"\";this._columns=oPara.columns||[];this._baseUrl=oPara.baseUrl||\"\";this._editMode=oPara.editMode||0;this._embedMode=oPara.embedMode||0;this._onlySingle=oPara.onlySingle||false;this._canAdd=oPara.canAdd||oPara.canAdd==undefined;this._canUpdate=oPara.canUpdate||oPara.canUpdate==undefined;this._canOpen=oPara.canOpen||oPara.canOpen==undefined;this._canDownload=oPara.canDownload||oPara.canDownload==undefined;this._canDelete=oPara.canDelete||oPara.canDelete==undefined;this._allowExtName=(oPara.allowExtName||\"\").split(\";\").trim();this._interface[\"uploadFile\"]=oPara.uploadFile;this._interface[\"openFile\"]=oPara.openFile;this._interface[\"downFile\"]=oPara.downFile;this._interface[\"delFile\"]=oPara.delFile;this._interface[\"getOpenFileUrl\"]=oPara.getOpenFileUrl;this._interface[\"getDownFileUrl\"]=oPara.getDownFileUrl;this._interface[\"getDelFileUrl\"]=oPara.getDelFileUrl;this._events[\"onValidateName\"]=oPara.onValidateName;this._events[\"onOpenError\"]=oPara.onOpenError;this._events[\"onDownError\"]=oPara.onDownError;this._events[\"onDelError\"]=oPara.onDelError;if(oPara.onBuild)this.addEventListener(\"onBuild\",oPara.onBuild);if(oPara.onAddFile)this.addEventListener(\"onBuild\",oPara.onBuild);if(oPara.onOpenFile)this.addEventListener(\"onBuild\",oPara.onBuild);if(oPara.onDownFile)this.addEventListener(\"onBuild\",oPara.onBuild);if(oPara.onUpdateFile)this.addEventListener(\"onBuild\",oPara.onBuild);if(oPara.onDelFile)this.addEventListener(\"onBuild\",oPara.onBuild);if(oPara.onRefresh)this.addEventListener(\"onRefresh\",oPara.onRefresh);this._data=oPara.data;this._target=this._parent=oPara.target;if(data){this.addFiles(data);this.build();}}\nprototype.getId=function(){return this._id;}\nprototype.getEditMode=function(){return this._editMode;}\nprototype.getEmbedMode=function(){return this._embedMode;}\nprototype.getSize=function(){return this._files.eval(function(sizes,size){return sizes+size;});}\nprototype.getCount=function(){return this._files.length;}\nprototype.getOnlySingle=function(){return this._onlySingle;}\nprototype.getBaseUrl=function(){return this._baseUrl;}\nprototype.getData=function(){return this._data;}\nprototype.setData=function(data){this._data=data;}\nprototype.getTemplate=function(){return this._template;}\nprototype.addFile=function(data,callback){var _this=this;var flag=this._onlySingle&&this._files.some(function(file){return!file.isDeleted;});if(this._status==0){if(flag||!data){if(callback)callback(0);return false;}\nthis._addFile(data);}else if(this._editMode==0){if(callback)callback(0);return false;}else if(flag){alert(this._getLocale(\"onlyUploadSingle\"));if(callback)callback(0);return false;}else{this._interface[\"uploadFile\"](false,function(data1){if(!Global.isArray(data1)){}else if(data1.length){data1=data1.getFirst();}else{if(callback)callback(0);return;}\nvar data2=_this._addFile(data1);_this.fireEvent(\"_onAddFile\",data1);if(callback)callback(1,data2);});return true;}}\nprototype._addFile=function(data,index){if(!data)return;var data1={id:data.id||data.name||\"\",name:data.name||\"\",title:data.title||\"\",description:data.description||\"\",size:data.size||0,user:data.user||\"\",time:data.time,data:data.data||\"\",openUrl:data.openUrl||\"\",downUrl:data.downUrl||\"\",delUrl:data.delUrl||\"\"}\nif(this._status==0){if(this._embedMode==1)data1.isNew=false;}else{if(!this.validateFileName(data1.name))return;if(this._embedMode==1)data1.isNew=true;}\nif(index==undefined)this._files.push(data1);else this._files.insert(data1,index);return data1;}\nprototype.addFiles=function(data,callback){var _this=this;var flag=this._onlySingle&&this._files.some(function(file){return!file.isDeleted;});if(this._status==0){this._addFiles(this._onlySingle?data.slice(0,1):data);if(callback)callback(1);}else if(this._editMode==0){if(callback)callback(0);return false;}else if(flag){alert(this._getLocale(\"onlyUploadSingle\"));if(callback)callback(0);return false;}else{this._interface[\"uploadFile\"](!this._onlySingle,function(data1){if(!data1){if(callback)callback(0);return;}else if(!Global.isArray(data1)){_this._addFiles([data1]);}else if(_this._onlySingle){_this._addFiles(data1.slice(0,1));}else{_this._addFiles(data1);}\nif(callback)callback();});return true;}}\nprototype._addFiles=function(data){data.forEach(function(file){this._addFile(file);if(this._status==1)this.fireEvent(\"_onAddFile\",file);},this);}\nprototype.getFile=function(index){return this._files[index];}\nprototype.getFileById=function(id){return this._files.getFirst(function(file){return file.id==id&&!file.isDeleted;});}\nprototype.getFileByName=function(name){return this._files.getFirst(function(file){return file.name.toLowerCase()==name.toLowerCase()&&!file.isDeleted;});}\nprototype.getFileUrl=function(file,vType){switch(vType){case\"open\":if(file.openUrl.slice(0,10).indexOf(\"://\")>0){return file.openUrl;}else if(this._interface[\"getOpenFileUrl\"]){return this._interface[\"getOpenFileUrl\"](file);}else{return[this._baseUrl,file.openUrl].join(\"/\");}\nbreak;case\"download\":if(file.downUrl.slice(0,10).indexOf(\"://\")>0){return file.downUrl;}else if(this._interface[\"getDownFileUrl\"]){return this._interface[\"getDownFileUrl\"](file);}else{return[this._baseUrl,file.downUrl].join(\"/\");}\nbreak;case\"delete\":if(file.delUrl.slice(0,10).indexOf(\"://\")>0){return file.delUrl;}else if(this._interface[\"getDelFileUrl\"]){return this._interface[\"getDelFileUrl\"](file);}else{return[this._baseUrl,file.delUrl].join(\"/\");}\nbreak;}}\nprototype.getFirstValidFile=function(){return this._files.getFirst(function(file){return!file.isDeleted;});}\nprototype.getAllFiles=function(){return this._files;}\nprototype.getAllValidFiles=function(){return this._files.filter(function(file){return!file.isDeleted;});}\nprototype.getAllChangedFiles=function(){if(!this._embedMode)return[];return this._files.filter(function(file){return file.isNew||file.isUpdated||file.isDeleted;});}\nprototype.getAllNewFiles=function(){if(!this._embedMode)return[];return this._files.filter(function(file){return file.isNew;});}\nprototype.getAllFilesToUpdate=function(){if(!this._embedMode)return[];return this._files.filter(function(file){return!file.isNew&&!file.isDeleted&&file.isUpdated;});}\nprototype.getAllFilesToDelete=function(){if(!this._embedMode)return[];return this._files.filter(function(file){return file.isDeleted;});}\nprototype.isExsitFileName=function(name){return this._files.some(function(file){return file.name.toLowerCase()==name.toLowerCase()&&!file.isDeleted;});}\nprototype.validateFileName=function(name){if(this._allowExtName.length){if(!this._allowExtName.some(function(extName){return name.toLowerCase().rightBack(\".\")==extName;})){alert(this._getLocale(\"notAllowUploadOtherTypeFile\",this._allowExtName.join(\";\")));return false;}}\nif(this.isExsitFileName(name)){alert(this._getLocale(\"fileAlreadyExists\",name));return false;}\nif(this._events[\"onValidateName\"]){return this._events[\"onValidateName\"](name);}\nreturn true;}\nprototype.openFile=function(id){var file=this.getFileById(id);if(!file)return;var file1={id:file.id,name:file.name,title:file.title,data:file.data,openUrl:this.getFileUrl(file,\"open\")}\nif(this._interface[\"openFile\"]){this._interface[\"openFile\"].call(this,file1);}else{window.open(file1.openUrl);}\nthis.fireEvent(\"_onOpenFile\",file1);}\nprototype.downFile=function(id){var file=this.getFileById(id);if(!file)return;var file1={id:file.id,name:file.name,title:file.title,data:file.data,downUrl:this.getFileUrl(file,\"download\")}\nif(this._interface[\"downFile\"]){this._interface[\"downFile\"].call(this,file1);}else{this._downloadFile(file1,this._events[\"onDownError\"]);}\nthis.fireEvent(\"_onDownFile\",file1);}\nprototype._downloadFile=function(sUrl,oPara,fnError){var htmlPara=[];for(var key in oPara){if(oPara.hasOwnProperty(key)){htmlPara.push(\"<input type=text name=\\\"\"+HTMLEncoder.encodeNodeAttrib(key)+\"\\\" value=\\\"\"+HTMLEncoder.encodeNodeAttrib(oPara[key])+\"\\\">\");}}\nwith(window.document.body.appendChild(document.createElement(\"iframe\"))){style.display=\"none\";onreadystatechange=function(){switch(this.readyState){case\"interactive\":if(typeof(this.contentWindow.document)==\"object\"){if(contentWindow.document.documentElement){}else{}}else{}\nthis.parentNode.removeChild(this);break\ncase\"complete\":if(typeof(fnError)==\"function\")fnError();break;}}\nwith(contentWindow.document){with(body||appendChild(createElement(\"body\"))){charset=\"utf-8\";with(appendChild(createElement(\"form\"))){method=\"post\";action=sUrl;target=\"_self\";with(appendChild(createElement(\"div\"))){innerHTML=htmlPara.join(\"\");}\nsubmit();}}}}}\nprototype.updateFile=function(id,callback){var _this=this;var file=this.getFileById(id);if(!file){if(callback)callback(0);return false;}\nif(this._status==0){if(callback)callback(0);return false;}else if(this._editMode==0){if(callback)callback(0);return false;}else if(file.isNew){if(callback)callback(0);return false;}else{this._interface[\"uploadFile\"](false,function(data1){if(!Global.isArray(data1)){}else if(data1.length){data1=data1.getFirst();}else{if(callback)callback(0);return;}\nif(file.name.toLowerCase()!=data1.name.toLowerCase()){alert(this._getLocale(\"mustUpdateSameFileName\"));if(callback)callback(0);return;}\n_this._updateFile(data1,file);_this.fireEvent(\"_onUpdateFile\",data1);});}}\nprototype._updateFile=function(newData,oldData){if(!newData)return;if(newData.size)oldData.size=newData.size;if(newData.user)oldData.user=newData.user;if(newData.time)oldData.time=newData.time;if(newData.openUrl)oldData.openUrl=newData.openUrl;if(newData.downUrl)oldData.downUrl=newData.downUrl;if(newData.delUrl)oldData.delUrl=newData.delUrl;return oldData;}\nprototype.replaceFile=function(id,callback){var _this=this;if(this._status==0){if(callback)callback(0);return false;}else if(this._editMode==0){if(callback)callback(0);return false;}else{this._interface[\"uploadFile\"](false,function(data1){if(!data1){if(callback)callback(0);return;}else if(!Global.isArray(data1)){}else if(data1.length){data1=data1.getFirst();}else{if(callback)callback(0);return;}\nvar data2=_this._replaceFile(data1,id);if(data2)_this.fireEvent(\"_onAddFile\",data1);if(data2&&callback)callback(1,data2);else if(callback)callback(0);});return true;}}\nprototype._replaceFile=function(newData,vOldData){var oldData,index=-1;if(!vOldData){}else if(typeof(vOldData)==\"string\"){var id=vOldData;for(var i=0;i<this._files.length;i++){var file=this._files[i];if(file.id==id&&!file.isDeleted){index=i;oldData=file;break;}}}else{oldData=vOldData;}\nif(index==-1){return this._addFile(newData);}else if(oldData.isNew){var newData1=this._addFile(newData,index+1);if(newData1)this.delFile(oldData.id);return newData1;}else{var newData1=this._addFile(newData,index+1);if(newData1)this.delFile(oldData.id);return newData1;}}\nprototype.delFile=function(id){var file=this.getFileById(id);if(!file||file.isDeleted)return;if(this._editMode==0)return;var file1={id:file.id,name:file.name,title:file.title,data:file.data,delUrl:this.getFileUrl(file,\"delete\")}\nif(this._embedMode==0||file.isNew){this._files.erase(file);if(this._interface[\"delFile\"]){this._interface[\"delFile\"].call(this,file1);}else if(file1.delUrl){Global.get(file1.delUrl,\"\",false,\"\",\"text\");}}else{file.isDeleted=true;}\nthis.fireEvent(\"_onDelFile\",file1);}\nprototype.build=function(){if(this._status==1)return;this._buildPage();this._status=1;this.fireEvent(\"_onBuild\");this.fireEvent(\"_onRefresh\");}\nprototype._buildPage=function(){var code=this._template.parse({app:this,data:{id:this._id,name:this._name,title:this._title,editMode:this._editMode,embedMode:this._embedMode,columns:this._columns,files:this.getAllValidFiles(),size:this.getSize(),count:this._files.length,data:this._data,onlySingle:this._onlySingle,canAdd:this._canAdd,canUpdate:this._canUpdate,canOpen:this._canOpen,canDownload:this._canDownload,canDelete:this._canDelete}});if(this._target){this._target.innerHTML=code;}else if(this._status==0){var script=Array.getLast(document.getElementsByTagName(\"SCRIPT\"));this._parent=script.parentNode;this._startPos=document.createElement(\"div\");this._startPos.style.display=\"none\";this._startPos.title=\"widgets-attachmentlist-start\";this._endPos=document.createElement(\"div\");this._endPos.style.display=\"none\";this._endPos.title=\"widgets-attachmentlist-end\";script.insertAdjacentElement(\"beforeBegin\",this._startPos);script.insertAdjacentHTML(\"beforeBegin\",code);script.insertAdjacentElement(\"beforeBegin\",this._endPos);}else if(this._endPos){for(var i=3,node;i>=0;i--){node=this._endPos.previousSibling;if(node==this._startPos)break;this._parent.removeChild(node);}\nthis._endPos.insertAdjacentHTML(\"beforeBegin\",code);}}\nprototype.refresh=function(){this._buildPage();this.fireEvent(\"_onRefresh\");}\nprototype._getLocale=function(key,value){var strObj=Global.Object(this.getClass()._localeResource[key]);return strObj.format.apply(strObj,Global.js.lang.natives.Array.from(arguments).slice(1)).valueOf();}\nprototype._onAddFile=function(file){this.fireEvent(\"onAddFile\",file);}\nprototype._onOpenFile=function(file){this.fireEvent(\"onOpenFile\",file);}\nprototype._onDownFile=function(file){this.fireEvent(\"onDownFile\",file);}\nprototype._onUpdateFile=function(file){this.fireEvent(\"onUpdateFile\",file);}\nprototype._onDelFile=function(file){this.fireEvent(\"onDelFile\",file);}\nprototype._onBuild=function(){this.fireEvent(\"onBuild\");}\nprototype._onRefresh=function(){this.fireEvent(\"onRefresh\");}}"
}
}
